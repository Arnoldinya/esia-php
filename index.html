<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Esia by fr05t1k</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Esia</h1>
      <h2 class="project-tagline">Компонент для авторизации на портале &quot;Госуслуги&quot; (ЕСИА)</h2>
      <a href="https://github.com/fr05t1k/esia" class="btn">View on GitHub</a>
      <a href="https://github.com/fr05t1k/esia/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/fr05t1k/esia/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="Единая-система-идентификации-и-аутентификации-ЕСИА-openid" class="anchor" href="#%D0%95%D0%B4%D0%B8%D0%BD%D0%B0%D1%8F-%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0-%D0%B8%D0%B4%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D0%B8-%D0%B8-%D0%B0%D1%83%D1%82%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D0%B8-%D0%95%D0%A1%D0%98%D0%90-openid" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Единая система идентификации и аутентификации (ЕСИА) OpenId</h1>

<p><a href="https://travis-ci.org/fr05t1k/esia"><img src="https://travis-ci.org/fr05t1k/esia.svg?branch=master" alt="Build Status"></a></p>

<h1>
<a id="Описание" class="anchor" href="#%D0%9E%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D0%B5" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Описание</h1>

<p>Компонент для авторизации на портале "Госуслуги"</p>

<h1>
<a id="Установка" class="anchor" href="#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Установка</h1>

<p>При помощи <a href="https://getcomposer.org/download/">composer</a>:</p>

<pre><code>composer require --prefer-dist fr05t1k/esia
</code></pre>

<p>Или добавьте в composer.json</p>

<pre><code>"fr05t1k/esia" : "dev-master"
</code></pre>

<h1>
<a id="Как-использовать" class="anchor" href="#%D0%9A%D0%B0%D0%BA-%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D1%8C" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Как использовать</h1>

<p>Пример получения ссылки для авторизации</p>

<pre><code>&lt;?php 
$config = [
   'clientId' =&gt; 'INSP03211',
   'redirectUrl' =&gt; 'http://my-site.com/response.php',
   'portalUrl' =&gt; 'https://esia-portal1.test.gosuslugi.ru/',
   'privateKeyPath' =&gt; 'my-site.com.pem',
   'privateKeyPassword' =&gt; 'my-site.com',
   'certPath' =&gt; 'my-site.com.pem',
   'tmpPath' =&gt; 'tmp',
];

$esia = new \esia\OpenId($config);
?&gt;

&lt;a href="&lt;?=$esia-&gt;getUrl()?&gt;Войти через портал госуслуги&lt;/a&gt;"
</code></pre>

<p>После редиректа на ваш <code>redirectUrl</code> вы получите в <code>$_GET['code']</code> код для получения токена</p>

<p>Пример получения токена и информации о пользователе</p>

<pre><code>
$esia = new \esia\OpenId($config);

$esia-&gt;getToken($_GET['code']);

$personInfo = $esia-&gt;getPersonInfo();
$addressInfo = $esia-&gt;getAddressInfo();
$contactInfo = $esia-&gt;getContactInfo();

</code></pre>

<h1>
<a id="Конфиг" class="anchor" href="#%D0%9A%D0%BE%D0%BD%D1%84%D0%B8%D0%B3" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Конфиг</h1>

<p><code>clientId</code> - ID вашего приложения.</p>

<p><code>redirectUrl</code> - URL куда будет перенаправлен ответ с кодом.</p>

<p><code>portalUrl</code> - по умолчанию: <code>https://esia-portal1.test.gosuslugi.ru/</code>. Домен портала для авторизация (только домен).</p>

<p><code>codeUrl</code> - по умолчанию: <code>aas/oauth2/ac</code>. URL для получения кода.</p>

<p><code>tokenUrl</code> - по умолчанию: <code>aas/oauth2/te</code>. URL для получение токена.</p>

<p><code>scope</code> - по умолчанию: <code>http://esia.gosuslugi.ru/usr_inf</code>. Запрашиваемые права у пользователя.</p>

<p><code>privateKeyPath</code> - путь до приватного ключа.</p>

<p><code>privateKeyPassword</code> - пароль от приватного ключа.</p>

<p><code>certPath</code> - путь до сертификата.</p>

<p><code>tmpPath</code> - путь до дериктории где будет проходить подпись (должна быть доступна для записи).</p>

<p><code>log</code> - callable с одни параметром $message, в который будет передаваться сообщения лога.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/fr05t1k/esia">Esia</a> is maintained by <a href="https://github.com/fr05t1k">fr05t1k</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
